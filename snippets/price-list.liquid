{%- comment -%}
Create a custom money format filter based on settings
{%- endcomment -%}

{%- liquid
  case context
    when 'card' or 'line_item'
      assign base_text_class = ''

      if settings.product_card_text_font == 'heading'
        assign base_text_class = 'h6 '
      endif

      assign regular_price_classes = base_text_class | append: 'text-subdued'
      assign on_sale_price_classes = base_text_class | append: 'text-on-sale'
      if block.settings.show_value_in_price
        assign compare_at_price_classes = base_text_class | append: 'h5 text-subdued'
      else
        assign compare_at_price_classes = base_text_class | append: 'h5 text-subdued line-through'
      endif
      assign unit_price_classes = base_text_class | append: 'text-subdued'

    when 'product'
      assign regular_price_classes = base_text_class | append: 'h4 text-subdued'
      assign on_sale_price_classes = base_text_class | append: 'h4 text-on-sale'
      if block.settings.show_value_in_price
        assign compare_at_price_classes = base_text_class | append: 'h5 text-subdued'
      else
        assign compare_at_price_classes = base_text_class | append: 'h5 text-subdued line-through'
      endif
      assign unit_price_classes = base_text_class | append: 'h6 text-subdued'
  endcase

  # Custom money formatting function
  
  assign show_cents = settings.show_cents | default: false
-%}

<price-list {% if form_id %}role="region" aria-live="polite"{% endif %} class="price-list {% if block.settings.show_value_in_price %}price-list-with-value{% endif %} {% if context == 'product' %}price-list--product{% endif %}" 
  {% if block.settings.show_value_in_price %}
    data-price-value="true" 
    data-total-value-text="{{ block.settings.total_value_text | escape }}"
  {% else %}
    data-price-value="false"
  {% endif %}
>
  {%- if variant != blank -%}
    {%- comment -%}
    --------------------------------------------------------------------------------------------------------------------
    VARIANT CASE (used on product page, quick view...)
    --------------------------------------------------------------------------------------------------------------------
    {%- endcomment -%}
    <compare-at-price-alt data-variant-id="{{ variant.id }}" {% if form_id %}form="{{ form_id }}"{% endif %} {% unless variant.compare_at_price > variant.price %}hidden{% endunless %} class="{{ compare_at_price_classes }}">
      <span class="sr-only">{{ 'product.price.regular_price' | t }}</span>
      {% if block.settings.show_value_in_price %}
        ({{ block.settings.total_value_text }}
      {% endif %}
      {%- if show_cents == false -%}
        {%- if settings.currency_code_enabled -%}
          {{- variant.compare_at_price | round | money_with_currency | replace: '.00', '' -}}
        {%- else -%}
          {{- variant.compare_at_price | round | money | replace: '.00', '' -}}
        {%- endif -%}
      {%- else -%}
        {%- if settings.currency_code_enabled -%}
          {{- variant.compare_at_price | money_with_currency -}}
        {%- else -%}
          {{- variant.compare_at_price | money -}}
        {%- endif -%}
      {%- endif -%}
      {% if block.settings.show_value_in_price %}){% endif %}
    </compare-at-price-alt>
     <sale-price-alt data-variant-id="{{ variant.id }}" {% if form_id %}form="{{ form_id }}"{% endif %} class="{% if variant.compare_at_price > variant.price %}{{ on_sale_price_classes }}{% else %}{{ regular_price_classes }}{% endif %}">
      <span class="sr-only">{{ 'product.price.sale_price' | t }}</span>

      {%- if show_cents == false -%}
        {%- if settings.currency_code_enabled -%}
          {{- variant.price | round | money_with_currency | replace: '.00', '' -}}
        {%- else -%}
          {{- variant.price | round | money | replace: '.00', '' -}}
        {%- endif -%}
      {%- else -%}
        {%- if settings.currency_code_enabled -%}
          {{- variant.price | money_with_currency -}}
        {%- else -%}
          {{- variant.price | money -}}
        {%- endif -%}
      {%- endif -%}
    </sale-price-alt>
  {%- elsif line_item != blank -%}
    {%- comment -%}
    --------------------------------------------------------------------------------------------------------------------
    LINE ITEM CASE (used on cart, order page...)
    --------------------------------------------------------------------------------------------------------------------
    {%- endcomment -%}
    <sale-price-alt  class="{% if line_item.original_price > line_item.final_price %}{{ on_sale_price_classes }}{% else %}{{ regular_price_classes }}{% endif %}">
      <span class="sr-only">{{ 'product.price.sale_price' | t }}</span>

      {%- if show_cents == false -%}
        {%- if settings.currency_code_enabled -%}
          {{- line_item.final_price | round | money_with_currency | replace: '.00', '' -}}
        {%- else -%}
          {{- line_item.final_price | round | money | replace: '.00', '' -}}
        {%- endif -%}
      {%- else -%}
        {%- if settings.currency_code_enabled -%}
          {{- line_item.final_price | money_with_currency -}}
        {%- else -%}
          {{- line_item.final_price | money -}}
        {%- endif -%}
      {%- endif -%}
    </sale-price-alt>

   
                  
   
    {%- if line_item.variant.compare_at_price > line_item.variant.price -%}
      <compare-at-price-alt class="{{ compare_at_price_classes }}">
        <span class="sr-only">{{ 'product.price.regular_price' | t }}</span>

        {%- if show_cents == false -%}
          {%- if settings.currency_code_enabled -%}
            {{- line_item.variant.compare_at_price | round | money_with_currency | replace: '.00', '' -}}
          {%- else -%}
            {{- line_item.variant.compare_at_price | round | money | replace: '.00', '' -}}
          {%- endif -%}
        {%- else -%}
          {%- if settings.currency_code_enabled -%}
            {{- line_item.variant.compare_at_price | money_with_currency -}}
          {%- else -%}
            {{- line_item.variant.compare_at_price | money -}}
          {%- endif -%}
        {%- endif -%}
      </compare-at-price-alt>
    {%- endif -%}
  {%- elsif product != blank -%}
    {%- comment -%}
    --------------------------------------------------------------------------------------------------------------------
    PRODUCT CASE (used on card)
    --------------------------------------------------------------------------------------------------------------------
    {%- endcomment -%}
    {%- liquid
      if product.price_varies and settings.product_price_strategy != 'from_price'
        assign variant = product.variants | sort: 'price' | last | default: product.selected_or_first_available_variant
      else
        assign variant = product.variants | sort: 'price' | first | default: product.selected_or_first_available_variant
      endif

      if show_cents == false 
        if settings.currency_code_enabled
          assign variant_price = variant.price | round | money_with_currency | replace: '.00', ''
          assign variant_compare_at_price = variant.compare_at_price | round | money_with_currency | replace: '.00', ''
        else
          assign variant_price = variant.price | round | money | replace: '.00', ''
          assign variant_compare_at_price = variant.compare_at_price | round | money | replace: '.00', ''
        endif
      else
        if settings.currency_code_enabled
          assign variant_price = variant.price | money_with_currency
          assign variant_compare_at_price = variant.compare_at_price | money_with_currency
        else
          assign variant_price = variant.price | money
          assign variant_compare_at_price = variant.compare_at_price | money
        endif
      endif
    -%}

    {%- if product.price_varies -%}
      {%- assign is_variant_on_sale = false -%}

      {%- if variant.price < variant.compare_at_price -%}
        {%- assign is_variant_on_sale = true -%}
      {%- endif -%}

      {%- if settings.product_price_strategy == 'from_price' -%}
        <sale-price-alt data-product-id="{{ product.id }}" class="{% if is_variant_on_sale %}{{ on_sale_price_classes }}{% else %}{{ regular_price_classes }}{% endif %}">
          <span class="sr-only">{{ 'product.price.sale_price' | t }}</span>
          {{- variant_price -}}
        </sale-price-alt>
      {%- else -%}
        <sale-price-alt data-product-id="{{ product.id }}" class="{{ on_sale_price_classes }}">
          <span class="sr-only">{{ 'product.price.sale_price' | t }}</span>
          {{- variant_price -}}
        </sale-price-alt>
      {%- endif -%}
    {%- else -%}
      <sale-price-alt data-product-id="{{ product.id }}" class="{% if variant.price < variant.compare_at_price %}{{ on_sale_price_classes }}{% else %}{{ regular_price_classes }}{% endif %}">
        <span class="sr-only">{{ 'product.price.sale_price' | t }}</span>
        {{- variant_price -}}
      </sale-price-alt>
    {%- endif -%}

    {%- if variant.price < variant.compare_at_price -%}
      <compare-at-price-alt data-product-id="{{ product.id }}" class="{{ compare_at_price_classes }}">
        <span class="sr-only">{{ 'product.price.regular_price' | t }}</span>
        {{- variant_compare_at_price -}}
      </compare-at-price-alt>
    {%- endif -%}
  {%- else -%}
    {%- comment -%}
    --------------------------------------------------------------------------------------------------------------------
    PLACEHOLDER CASE (used on featured product section for instance)
    --------------------------------------------------------------------------------------------------------------------
    {%- endcomment -%}

    <sale-price-alt class="{{ regular_price_classes }}">
      <span class="sr-only">{{ 'product.price.sale_price' | t }}</span>

      {%- if show_cents == false -%}
        {%- if settings.currency_code_enabled -%}
          {{- 4999 | round | money_with_currency | replace: '.00', '' -}}
        {%- else -%}
          {{- 4999 | round | money | replace: '.00', '' -}}
        {%- endif -%}
      {%- else -%}
        {%- if settings.currency_code_enabled -%}
          {{- 4999 | money_with_currency -}}
        {%- else -%}
          {{- 4999 | money -}}
        {%- endif -%}
      {%- endif -%}
    </sale-price-alt>
  {%- endif -%}

  {%- unless hide_unit_price -%}
    {%- assign unit_price_item = variant | default: line_item | default: product.selected_or_first_available_variant -%}

    {%- if unit_price_item.unit_price or form_id != blank -%}
      <unit-price {% if form_id %}form="{{ form_id }}"{% endif %} {% unless unit_price_item.unit_price %}hidden{% endunless %} class="{{ unit_price_classes }}">
        {%- assign unit_price_measurement = unit_price_item.unit_price_measurement -%}

        {%- if unit_price_measurement.reference_value != 1 -%}
          {%- assign reference_value = unit_price_measurement.reference_value -%}
        {%- endif -%}

        {%- if show_cents == false -%}
          ({{ unit_price_item.unit_price | round | money | replace: '.00', '' }}/{{ reference_value }}{{ unit_price_measurement.reference_unit }})
        {%- else -%}
          ({{ unit_price_item.unit_price | money }}/{{ reference_value }}{{ unit_price_measurement.reference_unit }})
        {%- endif -%}
      </unit-price>
    {%- endif -%}
  {%- endunless -%}
</price-list>

