{% comment %}
<script id="ABConvert-price-test-v1">
var abconvertCssSettings = {"_id":"660051c7ef0a595b74676ae5","storeName":"nobltravel.myshopify.com","singleVariantSelector":".variant-picker","productCardClass":"product-card,upsell_product","productPageDelay":0,"isPureVariantName":true,"bundleClassName":"vtl-ub-bundle-box__product-list,cbb-frequently-bought-container,th_pb_list_ul,bold-bundles-widget__items","isLocaleDecimal":false,"headIndex":0,"includeAtTop":false,"isSavingAmountExist":false,"isNotShowingDecimal":false,"isAttributeQuerySelector":false,"fromText":"From","hasRecommendationProduct":true,"bundleDelay":0,"hasColorSwatch":false,"isColorSwatchClassName":false,"inventoryNotificationButtonClass":"","customScript":"","hasVariantWizardSwatch":false,"needSelectFirstVariant":false,"hasCandyRackUpsell":false,"hasQuantityBreak":false,"__v":0};

var abconvertLiquidVariables = {
    abconvertProduct : {{ product | json }},
    shopMoneyFormat: {{ shop.money_format | json }},
    shopMoneyWithCurrencyFormat : {{ shop.money_with_currency_format | json }},
    currencySymbol: {{ cart.currency.symbol | json }},
    currencyCode: {{ cart.currency.iso_code | json }},
    shopifyProductId: {{ product.id | json }},
    shopifyProductHandle: {{ product.handle | json }},
    pageType: {{ request.page_type | json }}, // product, index, search, collections
    shopifySelectedOrFirstAvailableVariantId: {{ product.selected_or_first_available_variant.id | json }},
};
Object.keys(abconvertCssSettings).forEach(function(key) { 
    if(key!='storeName' && key!='__v' && key!='_id'){ 
        window[key] = abconvertCssSettings[key]; 
    } 
});

Object.keys(abconvertLiquidVariables).forEach(function(key) {
    window[key] = abconvertLiquidVariables[key];
});


var abconvertDict = {{ shop.metafields.abconvert.abconvertDict }};
 window.abconvertDict = abconvertDict;
(()=>{"use strict";const t=[/Googlebot/,/Googlebot-Image/,/Googlebot-Video/,/Googlebot-News/,/Storebot-Google/,/Google-InspectionTool/,/GoogleOther/,/Google-Extended/,/APIs-Google/,/AdsBot-Google-Mobile/,/AdsBot-Google/,/Mediapartners-Google/,/Google-Safety/,/FeedFetcher-Google/,/GoogleProducer/,/Bingbot/,/Slurp/,/DuckDuckBot/,/Baiduspider/,/YandexBot/,/facebot/,/Twitterbot/],e=(t,e,r)=>{let{operator:n,value:i,action:a,groupIndex:c=0}=e;switch(n){case"contain":return t.includes(i)?o({action:a,groupIndex:c}):-1;case"not contain":return t.includes(i)?-1:o({action:a,groupIndex:c});case"equal":return t===i?o({action:a,groupIndex:c}):-1;case"not equal":return t!==i?o({action:a,groupIndex:c}):-1;default:return-1}},o=t=>{let{action:e,groupIndex:o=0}=t;switch(e){case"assign-test-group":return o;case"assign-random":return"random";default:return 0}};(async()=>{const r=async function(t,e){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r={method:e,mode:"cors",headers:{"Content-Type":"application/json"}};o&&(r.body=JSON.stringify(o));let n=150,i=0;for(;i<3;)try{const e=await fetch(t,r);if(e.ok)return e.json();throw new Error(await e.json())}catch(t){if(n*=2,i+=1,i>=3)throw t;await new Promise((t=>setTimeout(t,n)))}throw new Error("API Error")};async function n(){localStorage.getItem("abconvert-country")||await async function(){const t=await fetch("https://app.abconvert.io/api/public/get-country-code",{method:"GET",mode:"cors"}),e=(await t.json()).countryCode;e&&localStorage.setItem("abconvert-country",e)}()}function i(){return localStorage.getItem("abconvert-country")}function a(t){let r,n=function(){const t=new URLSearchParams(location.search),e=t.get("preview"),o=t.get("countryCode");return o&&window.sessionStorage.setItem("abconvert-country",o),e&&!isNaN(Number(e))?(window.sessionStorage.setItem("abconvert-preview-number",e),t.get("preview")):window.sessionStorage.getItem("abconvert-preview-number")}();if(n&&!isNaN(Number(n)))if(n>=t.testPercentages.length)r=0;else{let e=!1;if(t.isFilteredByCountry&&t.filteredCountriesMap){const o=window.sessionStorage.getItem("abconvert-country");o&&!t.filteredCountriesMap[o]&&(e=!0)}r=e?0:n}else r=function(t){const{testPercentages:r,isFilteredByCountry:n,filteredCountriesMap:a,isFilteredByAudience:s,audienceFilterList:l,audienceFilterNotMatchAction:u,timeSinceLastArrivalFilter:g,isFilteredByCookie:f,cookieFilterList:d,cookieFilterNotMatchAction:m,newVsReturningVisitorFilter:b,startTime:p}=t;if(n){const t=i();if(a&&!a[t])return 0}if(s&&l.length&&u){let t;t=-1;for(let o=0;o<l.length;o++){const r=l[o],n=r.trafficSource,i=localStorage.getItem(n);if(i&&(t=e(i,r)),-1!=t)break}if(-1==t&&(t=o(u)),"random"!=t)return t}if(f&&d.length&&m){let t;t=-1;for(let o=0;o<d.length;o++){const r=d[o],n=c(r.key);if(n&&(t=e(n,r)),-1!=t)break}if(-1==t&&(t=o(m)),"random"!=t)return t}if(g){const{matchType:t,groupIndex:e,value:o,benchmark:r,otherwise:n}=g,i=(new Date).valueOf(),a=localStorage.getItem("abconvert-first-visit-time")?Number(localStorage.getItem("abconvert-first-visit-time")):i;localStorage.getItem("abconvert-first-visit-time")||localStorage.setItem("abconvert-first-visit-time",i.toString());const c=r-a;if("<"==t&&c<o)return e;if(">"==t&&c>o)return e;if("random"!=n)return n}if(b){let t;const e=(new Date).valueOf(),o=localStorage.getItem("abconvert-first-visit-time")?Number(localStorage.getItem("abconvert-first-visit-time")):e;if(localStorage.getItem("abconvert-first-visit-time")||localStorage.setItem("abconvert-first-visit-time",e.toString()),t=o>new Date(p).valueOf()?b.new:b.returning,"random"!=t)return Number(t)}const v=function(){let t=localStorage.getItem("abconvert-seed");return null==t&&(t=Math.floor(100*Math.random()).toString(),localStorage.setItem("abconvert-seed",t)),t}();let h,w=0;for(h=0;h<r.length;++h)if(w+=r[h],Number(v)<w)return h;return h}(t);return r}function c(t){for(var e=t+"=",o=document.cookie.split(";"),r=0;r<o.length;r++){for(var n=o[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return null}console.log("running ABConvert storewide script 1.0.0");try{if((()=>{const e=navigator.userAgent;return t.some((t=>t.test(e)))})())return;!async function(){abconvertDict&&abconvertDict.fetchCountryCode&&await n(),await async function(){try{for(let t=0;t<10;t++){const t=abconvertDict.experiments;let e={};if(t)for(let[o,r]of Object.entries(t)){const t=a(r);e[o]=t}localStorage.setItem("abconvert-price-test-experiment-to-group-index",JSON.stringify(e)),await n(),console.log("[LOG] Update cart attirbutes: ",{groupInfoPriceTestV1:e});const o=await r((window?.Shopify?.routes?.root??"/")+"cart.js","GET");console.log("[LOG] Original cart attributes: ",o.attributes);let s=o.attributes;const l=c("abconvert-session")||"",u=c("_shopify_y")||"",g={groupInfoPriceTestV1:JSON.stringify(e),abconvertCountry:i(),abconvertSearchParams:c("abconvert-search-params")??"",sessionId:l,clientId:u};if(console.log("[LOG] New cart attributes: ",g),!s.groupInfoPriceTestV1||s.groupInfoPriceTestV1!=JSON.stringify(e)){const t={"Content-Type":"application/json"},e="/cart/update.js",o=JSON.stringify({attributes:g});fetch(e,{method:"POST",headers:t,body:o}).then((t=>{t.ok?console.log("[LOG] Successfully update cart attributes"):console.log("Failed to update cart attributes")}))}}}catch(t){console.log("[ERROR] Update cart attributes: ",t)}}()}()}catch(t){console.log("[ABConvert] Error: ",t.message)}})()})();
(()=>{"use strict";var __webpack_modules__={643:(e,t,r)=>{r.d(t,{G:()=>o,v:()=>n});const n=(e,t,r)=>{let{operator:n,value:i,action:a,groupIndex:c=0}=t;switch(n){case"contain":return e.includes(i)?o({action:a,groupIndex:c}):-1;case"not contain":return e.includes(i)?-1:o({action:a,groupIndex:c});case"equal":return e===i?o({action:a,groupIndex:c}):-1;case"not equal":return e!==i?o({action:a,groupIndex:c}):-1;default:return-1}},o=e=>{let{action:t,groupIndex:r=0}=e;switch(t){case"assign-test-group":return r;case"assign-random":return"random";default:return 0}}},919:(e,t,r)=>{r.d(t,{Q:()=>o});const n=[/Googlebot/,/Googlebot-Image/,/Googlebot-Video/,/Googlebot-News/,/Storebot-Google/,/Google-InspectionTool/,/GoogleOther/,/Google-Extended/,/APIs-Google/,/AdsBot-Google-Mobile/,/AdsBot-Google/,/Mediapartners-Google/,/Google-Safety/,/FeedFetcher-Google/,/GoogleProducer/,/Bingbot/,/Slurp/,/DuckDuckBot/,/Baiduspider/,/YandexBot/,/facebot/,/Twitterbot/],o=()=>{const e=navigator.userAgent;return n.some((t=>t.test(e)))}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var _audience_filter_handler_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(643),_helper_is_bot_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(919);(async()=>{function uuidV4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function isSafariBrowser(){let e=navigator.userAgent;return e.includes("Safari")&&!e.includes("Chrome")}const currencyRoundingMap={KRW:1e3,INR:100,IDR:1e3,VND:1e3,PHP:100,JPY:100},optionValueKeys=["value","data-value","data-tooltip","data-escape","data-variant-id","data-vid","data-popup","v_id","data-id","data-option-value"];function directToVariant(e){var t=new URLSearchParams(location.search);t.set("variant",e),location.search=t.toString()}function sendViewEventXMR(e){var t=new XMLHttpRequest;let r="https://app.abconvert.io/api/observe?data="+btoa(JSON.stringify(e));t.open("GET",r),t.onload=function(){console.log(this.responseText)},t.send()}function getPrefixedLocalStorageItems(e){var t=Object.keys(localStorage).filter((function(t){return 0===t.indexOf(e)})),r={};return t.forEach((function(t){var n=t.slice(e.length),o=localStorage.getItem(t);r[n]=o})),r}function getCookie(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}function setCookie(e,t,r){var n,o=new Date;o.setTime(o.getTime()+r),n="; expires="+o.toUTCString(),document.cookie=e+"="+(t||"")+n+"; path=/"}async function getSession(){let e=getCookie("abconvert-session");return e||(e=uuidV4(),setCookie("abconvert-session",e,18e5)),e}async function sendVisitorEvent(e){let t="https://app.abconvert.io/api/observe/session?data="+btoa(JSON.stringify(e));fetch(t,{mode:"cors"}).then((e=>{e.ok?console.log("visitor recorded"):console.log("Failed to send product view event")}))}function recordVisitor(){getSession().then((async e=>{if(getCookie("abconvert-visitor-recorded"))return;setCookie("abconvert-visitor-recorded",!0,72e5);const t=abconvertDict.experiments;if(t)for(let[r,n]of Object.entries(t)){const t=getGroupIndex(n),o=getCookie("abconvert-search-params");sendVisitorEvent({sessionId:e,experimentId:r,groupIndex:t,pathName:window.location.pathname,searchParams:o?JSON.parse(o):""})}}))}async function sendViewEvent(e){let t="https://app.abconvert.io/api/observe?data="+btoa(JSON.stringify(e));fetch(t,{mode:"cors"}).then((e=>{e.ok?console.log("Product view"):console.log("Failed to send product view event")}))}function formatNumber(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e;if(abconvertDict?.multipleMarketPriceMap){if(!abconvertDict?.multipleMarketPriceMap?.[Shopify.country]&&window.Shopify&&window.Shopify.currency&&window.Shopify.currency.rate&&1!=window.Shopify.currency.rate)if(currencyRoundingMap[window.Shopify.currency.active]){const t=currencyRoundingMap[window.Shopify.currency.active];r=Math.ceil(e*window.Shopify.currency.rate/t)*t}else r=Math.ceil(e*window.Shopify.currency.rate)}else if(window.Shopify&&window.Shopify.currency&&window.Shopify.currency.rate&&1!=window.Shopify.currency.rate)if(currencyRoundingMap[window.Shopify.currency.active]){const t=currencyRoundingMap[window.Shopify.currency.active];r=Math.ceil(e*window.Shopify.currency.rate/t)*t}else r=Math.ceil(e*window.Shopify.currency.rate);return window.isNotShowingDecimal&&Number.isInteger(r)?t?r.toString().replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."):r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):t?parseFloat(r).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."):parseFloat(r).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function getHashNumber(){let e=localStorage.getItem("abconvert-seed");return null==e&&(e=Math.floor(100*Math.random()).toString(),localStorage.setItem("abconvert-seed",e)),e}function getGroupIndex(e){const{testPercentages:t,isFilteredByCountry:r,filteredCountriesMap:n,isFilteredByAudience:o,audienceFilterList:i,audienceFilterNotMatchAction:a,timeSinceLastArrivalFilter:c,isFilteredByCookie:s,cookieFilterList:l,cookieFilterNotMatchAction:d}=e;if(r){const e=getCountryCode();if(n&&!n[e])return 0}if(o&&i.length&&a){let e;e=-1;for(let t=0;t<i.length;t++){const r=i[t],n=r.trafficSource,o=localStorage.getItem(n);if(o&&(e=(0,_audience_filter_handler_js__WEBPACK_IMPORTED_MODULE_0__.v)(o,r,a)),-1!=e)break}if(-1==e&&(e=(0,_audience_filter_handler_js__WEBPACK_IMPORTED_MODULE_0__.G)(a)),"random"!=e)return e}if(s&&l.length&&d){let e;e=-1;for(let t=0;t<l.length;t++){const r=l[t],n=getCookie(r.key);if(n&&(e=(0,_audience_filter_handler_js__WEBPACK_IMPORTED_MODULE_0__.v)(n,r,d)),-1!=e)break}if(-1==e&&(e=(0,_audience_filter_handler_js__WEBPACK_IMPORTED_MODULE_0__.G)(d)),"random"!=e)return e}if(c){const{matchType:e,groupIndex:t,value:r,benchmark:n,otherwise:o}=c,i=(new Date).valueOf(),a=localStorage.getItem("abconvert-first-visit-time")?Number(localStorage.getItem("abconvert-first-visit-time")):i;localStorage.getItem("abconvert-first-visit-time")||localStorage.setItem("abconvert-first-visit-time",i.toString());const s=n-a;if("<"==e&&s<r)return t;if(">"==e&&s>r)return t;if("random"!=o)return o}const u=getHashNumber();let p,m=0;for(p=0;p<t.length;++p)if(m+=t[p],Number(u)<m)return p;return p}function isDirectedFromSamePage(){if(document.referrer){const e=new URL(document.referrer);if(e.pathname.includes("/products/"))return decodeURI(e.pathname).replace("/products/","").includes(window.shopifyProductHandle)||decodeURI(e.pathname).replace("/products/","").toLowerCase().includes(window.shopifyProductHandle)}return!1}function isTheRightVariant(){if(abconvertDict[window.shopifyProductId]){const e=abconvertDict[window.shopifyProductId],t=_getGroupIndex(e);let r=e.variantIds[t][0];const n=e.isFirstVariantSelected,o=e.firstVariantId;return!n&&o&&(r=o),new URLSearchParams(location.search).get("variant")==r}return!0}async function handleProductPageVisit(){if((!isDirectedFromSamePage()||!isTheRightVariant())&&abconvertDict[window.shopifyProductId]){const e=abconvertDict[window.shopifyProductId],t=getGroupIndex(e),r=e.variantIds[t][0],n=e.isFirstVariantSelected,o=e.firstVariantId;directToVariant(!n&&o?o:r)}}function handlePreviewProductPageVisit(e){if((!isDirectedFromSamePage()||!isTheRightVariant())&&abconvertDict[window.shopifyProductId]){const t=abconvertDict[window.shopifyProductId];if(e<t.testPercentages.length){let r=!1;if(t.isFilteredByCountry&&t.filteredCountriesMap){const e=getPreviewCountryCode();e&&!t.filteredCountriesMap[e]&&(r=!0)}if(r){const e=t.variantIds[0][0],r=t.isFirstVariantSelected,n=t.firstVariantId;directToVariant(!r&&n?n:e)}else{const r=t.variantIds[e][0],n=t.isFirstVariantSelected,o=t.firstVariantId;directToVariant(!n&&o?o:r)}}else{const e=t.variantIds[0][0],r=t.isFirstVariantSelected,n=t.firstVariantId;directToVariant(!r&&n?n:e)}}}function getVariantsToHide(e,t){return e.variantIds.all.filter((r=>!e.variantIds[t].includes(r)))}function getVariants(e,t){return e.variantIds[t]}function getVariantsOption(e,t){return Array.from(new Set(t.map((t=>e.variantToOption[t]))))}function handleSingleVariant(e){const t=e.querySelector("variant-radios"),r=e.querySelector("variant-selects");if(t&&(t.getAttribute("data-processed-abconvert-single-variant")||(t.style.display="none",t.setAttribute("data-processed-abconvert-single-variant","true"))),r&&(r.getAttribute("data-processed-abconvert-single-variant")||(r.style.display="none",r.setAttribute("data-processed-abconvert-single-variant","true"))),window.singleVariantSelector){const t=e.querySelectorAll(window.singleVariantSelector);if(t)for(let e of t)e.getAttribute("data-processed-abconvert-single-variant")||(e.style.display="none",e.setAttribute("data-processed-abconvert-single-variant","true"));window.customClassSelector&&e.querySelector(window.customClassSelector).classList.add("abconvert-custom-class")}}function handleVariantInputElement(e,t){if(!e.getAttribute("data-processed-abconvert-input-element")&&t.includes(e.value)){const t=e.parentElement,r=e.nextElementSibling;try{"LABEL"==r?.nodeName&&r.getAttribute("for")==e.getAttribute("id")&&r.remove()}catch(e){}e.remove(),t&&0==t.childElementCount&&!t.textContent.trim()&&(t.style.display="none"),t&&1==t.childElementCount&&"INPUT"==t.children[0].nodeName&&(t.style.display="none"),t&&t.classList.contains("color-swatch")&&(t.style.display="none"),e.setAttribute("data-processed-abconvert-input-element","true")}}function handleOptionElement(e,t){e.getAttribute("data-processed-abconvert-option-element")||t.includes(e.value)&&(e.style.display="none",isSafariBrowser()&&e.remove(),e.setAttribute("data-processed-abconvert-option-element","true"))}function handleDataValueOption(e,t){console.log("here"),e.map((e=>{const r=t.querySelectorAll(`[data-value="${e}"],[data-option="${e}"],[data-option-value="${e}"],[data-name="${e}"],[data-button="${e}"],[data-swatch-option="${e}"]`);for(let e of r)if(!e.getAttribute("data-processed-abconvert-data-value-option")){const t=e.parentElement;e.style.display="none",t&&0==t.childElementCount&&!t.textContent.trim()&&(t.style.display="none"),t&&t.parentElement&&t.parentElement.classList.contains("sf__tooltip-top")&&(t.parentElement.style.display="none"),e.setAttribute("data-processed-abconvert-data-value-option","true")}}))}function removeVariantsByOptions(e,t){createNodeFilterByValue(document.body,e).forEach((t=>{"INPUT"==t?.nodeName&&handleVariantInputElement(t,e),"OPTION"!=t?.nodeName&&"BUTTON"!=t?.nodeName||handleOptionElement(t,e)})),t&&handleSingleVariant(document.body),handleDataValueOption(e,document.body)}function getVariantById(e){const t=["value","data-value","data-tooltip","data-escape","data-variant-id","data-vid","data-popup","v_id","data-id","date-option-value","data-variantid","data-var_id"].map((t=>"["+t+'="'+e+'"]')).join(",");return document.querySelectorAll(t)}function getVariantByIdInElement(e,t){const r=["value","data-value","data-tooltip","data-escape","data-variant-id","data-vid","data-popup","v_id","data-id","date-option-value","data-variantid","data-var_id"].map((e=>"["+e+'="'+t+'"]')).join(",");return e.querySelectorAll(r)}function isOptionValueKeyExists(e,t){var r=new RegExp(t.join("|")+'=\\"\\d+\\"',"");return Array.from(e).some((function(e){return r.test(null==e?void 0:e.outerHTML)}))}function removeOptionsByVariantId(e){e.map((e=>{const t=getVariantById(e);for(let e of t)if(!e.parentElement?.classList.contains("rebuy-select")&&!e.getAttribute("data-processed-abconvert"))if("OPTION"===e.nodeName||"LI"===e.nodeName&&e.classList.contains("option"))e.style.display="none",isSafariBrowser()&&e.remove();else{e.style.display="none",e.setAttribute("data-processed-abconvert","true"),window.hasColorSwatch&&"LABEL"==e.nextElementSibling?.nodeName&&(e.nextElementSibling.style.display="none");const t=e.previousElementSibling,r=e.nextElementSibling;try{"LABEL"==t?.nodeName&&t.getAttribute("for")==e.getAttribute("id")&&(t.style.display="none"),"LABEL"==r?.nodeName&&r.getAttribute("for")==e.getAttribute("id")&&(r.style.display="none")}catch(e){}if(window.removeClosestTdInVariantId){const t=e.closest("td");t&&(t.style.display="none")}}}))}function removeOptionsByVariantIdInElement(e,t,r){t.map((t=>{const n=getVariantByIdInElement(e,t),o=[];for(let e of n)e.getAttribute("data-processed-abconvert")||("OPTION"===e.nodeName||"LI"===e.nodeName&&e.classList.contains("option")?(o.push(e.parentElement),e.style.display="none",isSafariBrowser()&&e.remove()):(e.style.display="none",e.setAttribute("data-processed-abconvert","true"),window.hasColorSwatch&&"LABEL"==e.nextElementSibling?.nodeName&&(e.nextElementSibling.style.display="none")));if(r)for(let e of o)"SELECT"==e?.nodeName&&(e.style.display="none")}))}function renameOptionsByVariantIds(e,t,r){e.map((e=>{const n=getVariantById(e);for(let o of n)o.getAttribute("data-processed-abconvert")||(o.textContent=o.textContent.replace(t[e],r[t[e]]),o.setAttribute("data-processed-abconvert","true"))}))}function handleBundleItemVariantIdInputs(e){e.map((e=>{const t=getVariantById(e);for(let e of t)e.getAttribute("data-processed-abconvert")&&e.getAttribute("input-clicked-abconvert")||("INPUT"==e.nodeName&&(e.setAttribute("checked","true"),elementChange(e)),"OPTION"==e.nodeName&&(e.setAttribute("selected","true"),elementChange(e)),e.setAttribute("input-clicked-abconvert","true"),e.setAttribute("data-processed-abconvert","true"))}))}function selectFirstOption(e){const t=e.querySelector("select");if(t&&!t.getAttribute("data-processed-abconvert-select-first-option")){const e=t.options;for(let r=0;r<e.length;r++)if("none"!=e[r].style.display){t.selectedIndex=r;break}t.setAttribute("data-processed-abconvert-select-first-option","true"),elementChange(t)}}function handleBundleItem(){const e=getBundleElements(),t=Object.keys(abconvertDict);for(let r of e){"IFRAME"==r.nodeName&&(r=r.contentWindow.document.body);for(let e of t)if(isNumber(e)){const t=abconvertDict[e],n=getGroupIndex(t),o=getVariantsToHide(t,n),i=getVariants(t,n),a=t.hasOnlyDefaultVariant??!1;removeElementVariantByOption(r,getVariantsOption(t,o),a),0!=n&&(renameVariantById(i,t.variantToOption),renameAllOptions()),removeOptionsByVariantIdInElement(r,o,a)}}}function handlePreviewBundleItem(e){const t=getBundleElements(),r=Object.keys(abconvertDict);for(let n of t){"IFRAME"==n.nodeName&&(n=n.contentWindow.document.body);for(let t of r)if(isNumber(t)){const r=abconvertDict[t];let o;if(e<r.testPercentages.length){let t=!1;if(r.isFilteredByCountry&&r.filteredCountriesMap){const e=getPreviewCountryCode();e&&!r.filteredCountriesMap[e]&&(t=!0)}o=t?0:e}else o=0;const i=getVariantsToHide(r,o),a=getVariants(r,o),c=r.hasOnlyDefaultVariant??!1;removeElementVariantByOption(n,getVariantsOption(r,i),c),0!=o&&(renameVariantById(a,r.variantToOption),renameAllOptions()),removeOptionsByVariantIdInElement(n,i,c)}}}function selectElementByOption(e){const t=document.querySelectorAll(`[data-value="${e}"]`);for(let e of t)e.click()}function applyStyleToTestVariant(e){console.log("Apply style to test variant");for(let[t,r]of Object.entries(e)){const e=document.querySelector(`[data-value="${r}"]`),n=document.querySelectorAll(`[data-value="${t}"]`);for(let t of n)if(t&&!t.getAttribute("data-processed-abconvert-color-swatch")&&e){let r=e.style.cssText;r=r.replace("display: none",""),t.style.cssText=r,t.setAttribute("data-processed-abconvert-color-swatch","true")}}}function _handleProductPage(e,t){const r=getVariantsToHide(e,t),n=e.hasOnlyDefaultVariant??!1;removeVariantsByOptions(getVariantsOption(e,r),n),removeOptionsByVariantId(r),window.shouldRenameVariantById&&0!=t&&renameVariantById(e.variantIds[t],e.variantToOption),window.hasQuantityBreak&&new MutationObserver((e=>{removeOptionsByVariantId(r)})).observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll(".abconvert-element").forEach((e=>{e.classList.remove("abconvert-element")}))}function handleProductPage(){if(abconvertDict[window.shopifyProductId]){const e=abconvertDict[window.shopifyProductId],t=getGroupIndex(e);if(isDirectedFromSamePage()&&!window.sessionStorage.getItem(e.productId)){let r=!0;if(e.isFilteredByCountry&&e.filteredCountriesMap){const t=getCountryCode();e.filteredCountriesMap[t]||(r=!1)}if(r){const r=getCookie("abconvert-search-params");sendViewEvent({productIndex:e.productIndex,productId:e.productId,groupIndex:t,experimentId:e.experimentId,searchParams:r?JSON.parse(r):""}),window.sessionStorage.setItem(e.productId,"true")}}console.log("product exist"),_handleProductPage(e,t)}document.querySelectorAll(".abconvert-element").forEach((e=>{e.classList.remove("abconvert-element")}))}function handlePreviewProductPage(e){if(abconvertDict[window.shopifyProductId]){const t=abconvertDict[window.shopifyProductId];let r;if(e<t.testPercentages.length){let n=!1;if(t.isFilteredByCountry&&t.filteredCountriesMap){const e=getPreviewCountryCode();e&&!t.filteredCountriesMap[e]&&(n=!0)}r=n?0:e}else r=0;_handleProductPage(t,r)}document.querySelectorAll(".abconvert-element").forEach((e=>{e.classList.remove("abconvert-element")}))}function getPreviewNumber(){const e=new URLSearchParams(location.search),t=e.get("preview"),r=e.get("countryCode");return r&&window.sessionStorage.setItem("abconvert-country",r),t&&!isNaN(Number(t))?(window.sessionStorage.setItem("abconvert-preview-number",t),e.get("preview")):window.sessionStorage.getItem("abconvert-preview-number")}function getProductList(){let e;return e=window.productCardClass?window.isAttributeQuerySelector?window.productCardClass:window.productCardClass.split(",").map((e=>"a"==e?e:"."+e)).join(","):["card-wrapper","product-item","grid-product__wrapper","collection-list__item","grid__item","grid-product","product-grid-item","product-card","grid-item","product-block","product__grid","ProductItem","product"].map((e=>"."+e)).join(","),document.querySelectorAll(e)}function removeElementVariantByOption(e,t,r){createNodeFilterByValue(e,t).forEach((e=>{"INPUT"==e?.nodeName&&handleVariantInputElement(e,t),"OPTION"==e?.nodeName&&handleOptionElement(e,t)})),r&&handleSingleVariant(e),handleDataValueOption(t,e)}function renameElementOptions(e,t){const r=Object.keys(t),n=createNodeFilterByTextContent(e,r);for(let e of n){const n=e.parentElement;n&&!n?.getAttribute("data-processed-abconvert")&&(t[e?.textContent?.trim()]?e.textContent=e?.textContent.replaceAll(e?.textContent?.trim(),t[e?.textContent?.trim()]):r.forEach((r=>{e?.textContent?.trim().includes(r)&&(e.textContent=t[r])})),n?.setAttribute("data-processed-abconvert","true"))}}function isAddToCartExist(e){return!!e.querySelector('form[action="/cart/add"]')}function updateAddToCart(e,t){const r=e.querySelector('form[action="/cart/add"]');if(r){const e=r.querySelector('input[name="id"]');e&&(e.value=t)}}function renameOptions(e){const t=Object.keys(e).reverse(),r=createNodeFilterByTextContent(document.body,t);for(let n of r){const r=n.parentElement;r&&!r?.getAttribute("data-processed-abconvert")&&(e[r?.textContent?.trim()]?(n.textContent=n?.textContent.replaceAll(n?.textContent?.trim(),e[n?.textContent?.trim()]),window.isColorSwatchClassName&&"LABEL"==r.nodeName&&(r.outerHTML=r.outerHTML.replaceAll("*",""))):t.forEach((t=>{n?.textContent?.trim().includes(t)&&(n.textContent=n.textContent.replace(t,e[t]))})),elementChange(r),r?.setAttribute("data-processed-abconvert","true"))}}function renameAllOptions(){const e=abconvertDict.allOptionsMap,t=Object.keys(e).reverse();createNodeFilterByTextContent(document.body,t).forEach((r=>{const n=r.parentElement;n&&!n.getAttribute("data-processed-abconvert-rename-all-options")&&t.forEach((t=>{r.textContent?.trim().includes(t)&&("Default Title"!=e[t]&&(r.textContent=r.textContent.replaceAll(t,e[t]),n.setAttribute("data-processed-abconvert-rename-all-options","true")),n.textContent?.includes("Default Title")&&"SPAN"==n.nodeName&&(n.previousSibling.textContent?.includes("Title")&&"SPAN"==n.previousSibling.nodeName&&(n.previousSibling.style.display="none"),n.style.display="none"))}))})),createNodeFilterByTextContent(document.body,["Title:","Default Title","Default Title*","Default Title**","Default Title***","Default Title****"]).forEach((e=>{const t=e.parentElement;t&&!t.getAttribute("data-processed-abconvert-default-title")&&(t.textContent?.includes("Default Title")||t.textContent?.includes("Title:"))&&(t.style.display="none")}))}function renameVariantById(e,t){const r=abconvertDict.allOptionsMap;let n=!1;e.forEach((e=>{const o=getVariantById(e);for(let i of o)if(!i.getAttribute("data-processed-abconvert-remove-variant-by-id")&&("OPTION"===i.nodeName||"LI"===i.nodeName&&i.classList.contains("option"))){const o=t[e];i.textContent=i.textContent.replace(o,r[o]),i.setAttribute("data-processed-abconvert-remove-variant-by-id","true"),n||(i.setAttribute("selected","selected"),elementChange(i),n=!0)}}))}function elementChange(e){try{e.dispatchEvent(new Event("change",{bubbles:!0}))}catch(e){console.log("Failed to trigger a change event.")}}function elementClick(e){try{e.dispatchEvent(new Event("click",{bubbles:!0}))}catch(e){console.log("Failed to trigger a click event.")}}function selectFirstVariant(e,t){console.log("select first variant");const r=e.querySelectorAll("form");console.log("forms: ",r);for(let e of r){console.log("form: ",e);const r=e.querySelector("input[name='id']");r&&(console.log("input: ",r),r.getAttribute("data-processed-abconvert-add-to-cart")||(r.setAttribute("value",t),r.setAttribute("data-processed-abconvert-add-to-cart","true")))}}function selectFirstInput(e,t){const r=e.querySelector(`input[value="${t}"]`);r&&(r.getAttribute("data-processed-abconvert-select-first-input")||(r.checked=!0,r.setAttribute("data-processed-abconvert-select-first-input","true")))}function cleanUpProductByProductId(e,t,r){const n=abconvertDict[t],o=getVariantsToHide(n,r),i=n.hasOnlyDefaultVariant??!1,a=getVariantsOption(n,o);removeElementVariantByOption(e,a,i),removeOptionsByVariantId(o),0!=r&&(selectFirstVariant(e,n.variantIds[r][0]),selectFirstInput(e,n.variantToOption[n.variantIds[r][0]]),registerFunctionOnWindowLoad((()=>{selectFirstVariant(e,n.variantIds[r][0])})),selectFirstOption(e),selectOptionByVariantId(e,n.variantIds[r][0]))}function handleSwatchVariantColor(e){const t=e.querySelector(".grid-product__colors");if(t){const e={};for(let r of t.childNodes)"SPAN"==r.nodeName&&(e[r.style.backgroundColor]?r.style.display="none":e[r.style.backgroundColor]=!0)}}function changeElementPrice(e,t,r){e.innerHTML=e.innerHTML.replaceAll(t,r)}function isProductExist(e,t){const r=e.querySelectorAll("a");if(r.length)return Array.from(r).filter((e=>{if(!e.href)return!1;const r=new URL(e.href).pathname.split("/");return r[r.length-1]==encodeURI(`${t}`)})).length>0;{if("A"==e.nodeName){if(!e.href)return!1;const r=new URL(e.href).pathname.split("/");return r[r.length-1]==encodeURI(`${t}`)}const r=e.getAttribute("data-url");if(r){const e=r.split("/");return e[e.length-1]==encodeURI(`${t}`)}{const r=e.querySelectorAll("[data-url]");if(r.length)return Array.from(r).filter((e=>{const r=e.getAttribute("data-url").split("/");return r[r.length-1]==encodeURI(`${t}`)})).length>0}return!1}}function isProductExistById(e,t){const r=["data-product-id","id"].map((e=>"["+e+'="'+t+'"]')).join(",");return 0!=e.querySelectorAll(r).length||e.getAttribute("data-product-id")==t}const allEqual=e=>e.every((t=>t===e[0]));function generatePriceParams(e,t){const r=e[0].price,n=allEqual(r),o=Math.min(...r),i=Math.min(...e[0].compareAtPrice),a=[].concat(...Object.keys(e).map((t=>e[t].price))),c=[].concat(...Object.keys(e).map((t=>e[t].compareAtPrice)));return{originLowestPrice:o,originCompareAtPrice:i,lowestPrice:Math.min(...a),lowestCompareAtPrice:Math.min(...c),priceToReplace:Math.min(...e[t].price),compareAtPriceToReplace:Math.min(...e[t].compareAtPrice),originalFirstVariantPrice:e[0].price[0],originalFirstVariantCompareAtPrice:e[0].compareAtPrice[0],firstVariantPrice:e[t].price[0],firstVariantCompareAtPrice:e[t].compareAtPrice[0],onlyVariant:1==r.length,isSamePrice:n}}function getProductCardParams(e,t){if(abconvertDict.multipleMarketPriceMap&&abconvertDict.multipleMarketPriceMap[Shopify.country]){const r=e.productId,n=abconvertDict.multipleMarketPriceMap[Shopify.country][r];if(n)return{...generatePriceParams(n,t),slug:e.slug}}const r=e.lowestPrice[0],n=e.lowestCompareAtPrice[0],o=e.allLowestPrice,i=e.allLowestCompareAtPrice,a=e.lowestPrice[t],c=e.lowestCompareAtPrice[t],s=e.slug,l=1==e.variantIds[t].length;return{originLowestPrice:r,originCompareAtPrice:n,lowestPrice:o,lowestCompareAtPrice:i,priceToReplace:a,compareAtPriceToReplace:c,originalFirstVariantPrice:e.firstVariantPrice[0],originalFirstVariantCompareAtPrice:e.firstVariantCompareAtPrice[0],firstVariantPrice:e.firstVariantPrice[t],firstVariantCompareAtPrice:e.firstVariantCompareAtPrice[t],slug:s,onlyVariant:l,isSamePrice:!!e.isSamePrice}}function _handleProductCard(e,t,r,n){let{originLowestPrice:o,originCompareAtPrice:i,lowestPrice:a,lowestCompareAtPrice:c,priceToReplace:s,compareAtPriceToReplace:l,originalFirstVariantPrice:d,originalFirstVariantCompareAtPrice:u,firstVariantPrice:p,firstVariantCompareAtPrice:m,slug:f,onlyVariant:g,isSamePrice:b}=n;if((isProductExist(e,f)||isProductExistById(e,r))&&!e.getAttribute("data-processed-abconvert")){cleanUpProductByProductId(e,r,t);const n={};if(n[formatNumber(a)]=formatNumber(s),n[formatNumber(a,!0)]=formatNumber(s,!0),n[formatNumber(o)]=formatNumber(s),n[formatNumber(o,!0)]=formatNumber(s,!0),c&&l&&(n[formatNumber(c)]=formatNumber(l),n[formatNumber(i)]=formatNumber(l),n[formatNumber(c,!0)]=formatNumber(l,!0),n[formatNumber(i,!0)]=formatNumber(l,!0)),n[formatNumber(d)]=formatNumber(p),n[formatNumber(d,!0)]=formatNumber(p,!0),u&&m&&(n[formatNumber(u)]=formatNumber(m),n[formatNumber(u,!0)]=formatNumber(m,!0)),window.isSavingAmountExist){const e=c-a,t=i-o,r=l-s;c>0&&(n[formatNumber(e)]=formatNumber(r),n[formatNumber(e,!0)]=formatNumber(r,!0)),t>0&&(n[formatNumber(t)]=formatNumber(r),n[formatNumber(t,!0)]=formatNumber(r,!0))}console.log("priceReplaceMap: ",n);const f=Object.keys(n),g=createNodeFilterByPrice(e,f);for(let e of g)e.parentNode.getAttribute("data-processed-abconvert-price")||f.forEach((t=>{e.parentNode.getAttribute("data-processed-abconvert-price")||e.textContent?.trim().includes(t)&&(e.textContent=e.textContent.replace(t,n[t]),e.parentNode.setAttribute("data-processed-abconvert-price","true"))}));if(b){let t;t=window.fromText&&"string"==typeof window.fromText?[window.fromText,window.fromText.toLowerCase()]:["From","from"];const r=createNodeFilterByPrice(e,t);for(let e of r){const r=e.parentNode;r.getAttribute("data-processed-abconvert-from-text")||(t.forEach((t=>{e.textContent?.trim().includes(t)&&(e.textContent=e.textContent.replaceAll(t,""))})),r.setAttribute("data-processed-abconvert-from-text","true"))}if(window.priceVariesClass){const t=e.querySelector(`${window.priceVariesClass}`);t&&(t.style.display="none")}}handleSwatchVariantColor(e),e.setAttribute("data-processed-abconvert","true")}}function handleProductCard(){const e=getProductList();for(let[t,r]of Object.entries(abconvertDict))if(isNumber(t)){const t=getGroupIndex(r),{originLowestPrice:n,originCompareAtPrice:o,lowestPrice:i,lowestCompareAtPrice:a,priceToReplace:c,compareAtPriceToReplace:s,originalFirstVariantPrice:l,originalFirstVariantCompareAtPrice:d,firstVariantPrice:u,firstVariantCompareAtPrice:p,slug:m,onlyVariant:f,isSamePrice:g}=getProductCardParams(r,t);for(let b of e)_handleProductCard(b,t,r.productId,{originLowestPrice:n,originCompareAtPrice:o,lowestPrice:i,lowestCompareAtPrice:a,priceToReplace:c,compareAtPriceToReplace:s,originalFirstVariantPrice:l,originalFirstVariantCompareAtPrice:d,firstVariantPrice:u,firstVariantCompareAtPrice:p,slug:m,onlyVariant:f,isSamePrice:g})}document.querySelectorAll(".abconvert-element").forEach((e=>{e.classList.remove("abconvert-element")}))}function isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function handlePreviewProductCard(e){const t=getProductList();for(let[r,n]of Object.entries(abconvertDict))if(isNumber(r)){let r;if(e>=n.testPercentages.length)r=0;else{let t=!1;if(n.isFilteredByCountry&&n.filteredCountriesMap){const e=getPreviewCountryCode();e&&!n.filteredCountriesMap[e]&&(t=!0)}r=t?0:e}const{originLowestPrice:o,originCompareAtPrice:i,lowestPrice:a,lowestCompareAtPrice:c,priceToReplace:s,compareAtPriceToReplace:l,originalFirstVariantPrice:d,originalFirstVariantCompareAtPrice:u,firstVariantPrice:p,firstVariantCompareAtPrice:m,slug:f,onlyVariant:g,isSamePrice:b}=getProductCardParams(n,r);for(let e of t)_handleProductCard(e,r,n.productId,{originLowestPrice:o,originCompareAtPrice:i,lowestPrice:a,lowestCompareAtPrice:c,priceToReplace:s,compareAtPriceToReplace:l,originalFirstVariantPrice:d,originalFirstVariantCompareAtPrice:u,firstVariantPrice:p,firstVariantCompareAtPrice:m,slug:f,onlyVariant:g,isSamePrice:b})}document.querySelectorAll(".abconvert-element").forEach((e=>{e.classList.remove("abconvert-element")}))}function handleAddToCartSubmit(){document.addEventListener("submit",(function(e){"string"==typeof e.target.action==("/cart/add"===e.target.action.slice(-9))&&(console.log("add to cart here"),renameAllOptions())}))}function getBundleElements(){let e;e=window.bundleClassName?bundleClassName:"vtl-ub-bundle-box__product-list,cbb-frequently-bought-container,th_pb_list_ul,bold-bundles-widget__items,ast-vd-total-price-wrapper";const t=e.split(",").map((e=>e.includes("#")?e:"."+e)).join(",");return document.querySelectorAll(t)}function isBundleAdded(){return!!getBundleElements().length}async function fetchCountryCode(){const e=await fetch("https://app.abconvert.io/api/public/get-country-code",{method:"GET",mode:"cors"}),t=(await e.json()).countryCode;t&&(console.log("successfully set country code: ",t),localStorage.setItem("abconvert-country",t))}function setUrlParams(){const e=new URLSearchParams(location.search);for(let[t,r]of e.entries())localStorage.setItem(t,r);console.log("successfully set url params")}async function setCountryCode(){localStorage.getItem("abconvert-country")||await fetchCountryCode()}function getCountryCode(){return localStorage.getItem("abconvert-country")}function getPreviewCountryCode(){return window.sessionStorage.getItem("abconvert-country")}function handleCandyRackUpsell(){const e=document.body;new MutationObserver((function(e,t){for(let t of e)if("childList"===t.type&&t.addedNodes.length>0)for(let e of t.addedNodes)"IFRAME"==e.nodeName&&"candyrack-frame"==e.getAttribute("id")&&_handleCandyRackIframeElemet(e)})).observe(e,{childList:!0,subtree:!0})}const _handleCandyRackIframeElemet=e=>{const t=e.contentWindow.document.body;let r=getPreviewNumber();setTimeout((()=>{const e=t.querySelectorAll("li");for(let n of e){let e=n.getAttribute("id"),o=n.getAttribute("data-offer-id");const i=e.replace(o,"");if(abconvertDict[i]){const e=abconvertDict[i];let o;if(r&&!isNaN(Number(r)))if(r>=e.testPercentages.length)o=0;else{let t=!1;if(e.isFilteredByCountry&&e.filteredCountriesMap){const r=getPreviewCountryCode();r&&!e.filteredCountriesMap[r]&&(t=!0)}o=t?0:r}else o=getGroupIndex(e);const a=getVariantsToHide(e,o),c=e.hasOnlyDefaultVariant??!1;if(selectOptionByVariantId(n,e.variantIds[o][0]),removeOptionsByVariantIdInElement(n,a,c),c&&(n.querySelector(".Select-Variant--wrapper").style.display="none"),0!=o){const r=getVariants(e,o);renameVariantIdInCandyRackElement(t,r,e.variantToOption)}}}}),1e3),e.onload=function(){const e=t.querySelectorAll("li");for(let n of e){let e=n.getAttribute("id"),o=n.getAttribute("data-offer-id");const i=e.replace(o,"");if(abconvertDict[i]){const e=abconvertDict[i];let o;if(r&&!isNaN(Number(r)))if(r>=e.testPercentages.length)o=0;else{let t=!1;if(e.isFilteredByCountry&&e.filteredCountriesMap){const r=getPreviewCountryCode();r&&!e.filteredCountriesMap[r]&&(t=!0)}o=t?0:r}else o=getGroupIndex(e);const a=getVariantsToHide(e,o),c=e.hasOnlyDefaultVariant??!1;if(selectOptionByVariantId(n,e.variantIds[o][0]),removeOptionsByVariantIdInElement(n,a,c),c&&(n.querySelector(".Select-Variant--wrapper").style.display="none"),0!=o){const r=getVariants(e,o);renameVariantIdInCandyRackElement(t,r,e.variantToOption)}}}}};function selectOptionByVariantId(e,t){const r=e.querySelector("select");if(r&&!r.getAttribute("data-processed-abconvert-select-first-option-by-id")){const e=r.options;for(let r=0;r<e.length;r++)if(e[r].value==t){e.selectedIndex=r;break}r.setAttribute("data-processed-abconvert-select-first-option-by-id","true"),elementChange(r)}}function renameVariantIdInCandyRackElement(e,t,r){const n=abconvertDict.allOptionsMap;t.forEach((t=>{const o=getVariantByIdInElement(e,t);for(let e of o)if(!e.getAttribute("data-processed-abconvert-candy-rack")&&"OPTION"===e.nodeName){const o=r[t];e.textContent=e.textContent.replace(o,n[o]),e.setAttribute("data-processed-abconvert-candy-rack","true")}}))}function handleFrequentlyBoughtTogether(e){const t=Object.keys(abconvertDict),r=e.querySelector(".cbb-frequently-bought-selector-list").childNodes;if(!e.getAttribute("data-processed-abconvert-frequently-bought-together")){for(let e of t)if(Number(e))for(let t of r)if(t.querySelector(`[name="product_${e}"]`)){const r=abconvertDict[e];let n,o=getPreviewNumber();if(o&&!isNaN(Number(o)))if(o>=r.testPercentages.length)n=0;else{let e=!1;if(r.isFilteredByCountry&&r.filteredCountriesMap){const t=getPreviewCountryCode();t&&!r.filteredCountriesMap[t]&&(e=!0)}n=e?0:o}else n=getGroupIndex(r);const i=getVariantsToHide(r,n),a=r.hasOnlyDefaultVariant??!1;selectOptionByVariantId(t,r.variantIds[n][0]),removeOptionsByVariantIdInElement(t,i,a)}e.setAttribute("data-processed-abconvert-frequently-bought-together","true")}}function handleQuickAddDrawer(){new MutationObserver((function(e){for(let t of e)if("QUICK-BUY-DRAWER"==t.target.nodeName){const e=t.target.getAttribute("id").split("-").pop(),r=abconvertDict[e];if(r){let e;const n=r.testPercentages.length;let o=getPreviewNumber();if(o&&!isNaN(Number(o)))if(o<n){let t=!1;if(r.isFilteredByCountry&&r.filteredCountriesMap){const e=getPreviewCountryCode();e&&!r.filteredCountriesMap[e]&&(t=!0)}e=t?0:o}else e=0;else e=getGroupIndex(r);const{originLowestPrice:i,originCompareAtPrice:a,lowestPrice:c,lowestCompareAtPrice:s,priceToReplace:l,compareAtPriceToReplace:d,originalFirstVariantPrice:u,originalFirstVariantCompareAtPrice:p,firstVariantPrice:m,firstVariantCompareAtPrice:f,slug:g,onlyVariant:b,isSamePrice:y}=getProductCardParams(r,e);_handleProductCard(t.target,e,r.productId,{originLowestPrice:i,originCompareAtPrice:a,lowestPrice:c,lowestCompareAtPrice:s,priceToReplace:l,compareAtPriceToReplace:d,originalFirstVariantPrice:u,originalFirstVariantCompareAtPrice:p,firstVariantPrice:m,firstVariantCompareAtPrice:f,slug:g,onlyVariant:b,isSamePrice:y})}}})).observe(document.body,{childList:!0,subtree:!0})}function _getGroupIndex(e){let t,r=getPreviewNumber();if(r&&!isNaN(Number(r)))if(r>=e.testPercentages.length)t=0;else{let n=!1;if(e.isFilteredByCountry&&e.filteredCountriesMap){const t=getPreviewCountryCode();t&&!e.filteredCountriesMap[t]&&(n=!0)}t=n?0:r}else t=getGroupIndex(e);return t}function handleRebuyWidgets(){document.addEventListener("rebuy.ready",(function(e){const t=window.Rebuy.widgets;for(let e=0;e<t.length;++e){const r=t[e];if("ready"==r.status){const e=r.data.products;for(let t=0;t<e.length;++t){let r=e[t];if(abconvertDict[r.id]){const e=abconvertDict[r.id];let t=_getGroupIndex(e);const n=e.variantIds[t],o=r.variants.filter((e=>n.includes(e.id.toString())));r.variants=o,r.selected_variant=o[0],r.selected_variant_id=Number(o[0].id)}}}}}))}function handleUpcartUpsell(e){if(0!=e.length){console.log("handleUpcartUpsell: ",e);for(let t of e){const e=t.id,r=abconvertDict[e];if(r){const e=_getGroupIndex(r);if(0!=e){const n=r.variantIds[e][0],o=r.variantToPrice[n];if(t.price=100*o,t.compare_at_price){const e=r.variantToCompareAtPrice[n];t.compare_at_price=100*e}if(t.variants.length>r.variantIds[e].length){const n=getVariantsToHide(r,e).map((e=>Number(e))),o=t.variants.filter((e=>!n.includes(e.id)));t.variants=o}else{const n=t.variants.map((t=>{const n=t.id,o=r.variantToVariant[e][n];if(o){const e=r.variantToPrice[o],n=r.variantToCompareAtPrice[o];return{...t,id:Number(o),price:100*e,compare_at_price:n?100*n:null}}return t}));t.variants=n}}}}}}function handleUpcartModifyCart(e){for(let t of e.items){const e=t.product_id,r=abconvertDict[e];r&&r.hasOnlyDefaultVariant&&(t.product_has_only_default_variant=!0)}}function recordSearchParams(){if(!getCookie("abconvert-search-params")){const e=new URLSearchParams(location.search);if(e.size){const t={};for(let[r,n]of e.entries())"variant"!=r&&"page"!=r&&(t[r]=n);setCookie("abconvert-search-params",JSON.stringify(t),72e5)}}}async function abconvertOperation(){const styleElement=document.createElement("style"),cssRule="\n                .abconvert-element {\n                    display: none !important;\n                }\n                /* Add more CSS rules here */\n            ";styleElement.textContent=cssRule,document.head.appendChild(styleElement),setTimeout((()=>{document.head.removeChild(styleElement)}),2500);const previewNumber=getPreviewNumber();abconvertDict&&abconvertDict.fetchCountryCode&&await setCountryCode(),abconvertDict&&abconvertDict.setUrlParmas&&setUrlParams(),previewNumber||recordVisitor(),("index"==window.pageType||"collection"==window.pageType||window.pageType.includes("search")||"page"==window.pageType)&&(previewNumber&&!isNaN(Number(previewNumber))?(registerFunction((()=>{handlePreviewProductCard(Number(previewNumber))})),registerFunction((()=>{const e=new MutationObserver((function(e){handlePreviewProductCard(Number(previewNumber))}));try{e.observe(document.body,{childList:!0,subtree:!0})}catch(e){console.log("[ABConvert] Error: ",e.message)}}))):(registerFunction(handleProductCard),registerFunction((()=>{const e=new MutationObserver((function(e){handleProductCard()}));try{e.observe(document.body,{childList:!0,subtree:!0})}catch(e){console.log("[ABConvert] Error: ",e.message)}})))),"product"==window.pageType&&(previewNumber&&!isNaN(Number(previewNumber))?(handlePreviewProductPageVisit(Number(previewNumber)),registerFunction((()=>{window.productPageDelay?setTimeout((()=>{handlePreviewProductPage(Number(previewNumber))}),window.productPageDelay):handlePreviewProductPage(Number(previewNumber))})),registerFunction((()=>{const e=document.querySelector(".cbb-frequently-bought-container");e&&handleFrequentlyBoughtTogether(e),new MutationObserver((function(e){const t=document.querySelector(".cbb-frequently-bought-container");t&&handleFrequentlyBoughtTogether(t)})).observe(document.body,{childList:!0,subtree:!0})})),registerFunction((()=>{const e=new MutationObserver((function(e){for(let t=0;t<e.length;++t){const r=e[t],n=isBundleAdded();if(n||"childList"==r.type&&r.addedNodes.length&&isOptionValueKeyExists(r.addedNodes,optionValueKeys)){n&&(window.bundleDelay?setTimeout((()=>{handlePreviewBundleItem(Number(previewNumber))}),window.bundleDelay):(console.log("handle bundle"),handlePreviewBundleItem(Number(previewNumber))),window._rsi&&window._rsi.form.quantityOffers.updatePricesFirst());break}}}));try{e.observe(document.body,{childList:!0,subtree:!0})}catch(e){console.log("[ABConvert] Error: ",e.message)}})),window.hasRecommendationProduct&&(registerFunction((()=>{handlePreviewProductCard(Number(previewNumber))})),registerFunction((()=>{const e=new MutationObserver((function(e){handlePreviewProductCard(Number(previewNumber))}));try{e.observe(document.body,{childList:!0,subtree:!0})}catch(e){console.log("[ABConvert] Error: ",e.message)}})))):(handleProductPageVisit(),registerFunction((()=>{window.productPageDelay?setTimeout((()=>{handleProductPage()}),window.productPageDelay):handleProductPage()})),registerFunction((()=>{const e=document.querySelector(".cbb-frequently-bought-container");e&&handleFrequentlyBoughtTogether(e),new MutationObserver((function(e){const t=document.querySelector(".cbb-frequently-bought-container");t&&handleFrequentlyBoughtTogether(t)})).observe(document.body,{childList:!0,subtree:!0})})),registerFunction((()=>{const e=new MutationObserver((function(e){for(let t=0;t<e.length;++t){const r=e[t],n=isBundleAdded();if(n||"childList"==r.type&&r.addedNodes.length&&isOptionValueKeyExists(r.addedNodes,optionValueKeys)){n&&(window.bundleDelay?setTimeout((()=>{handleBundleItem()}),window.bundleDelay):handleBundleItem(),window._rsi&&window._rsi.form.quantityOffers.updatePricesFirst());break}}}));try{e.observe(document.body,{childList:!0,subtree:!0})}catch(e){console.log("[ABConvert] Error: ",e.message)}})),window.hasRecommendationProduct&&(registerFunction(handleProductCard),registerFunction((()=>{const e=new MutationObserver((function(e){handleProductCard()}));try{e.observe(document.body,{childList:!0,subtree:!0})}catch(e){console.log("[ABConvert] Error: ",e.message)}}))))),window.customScript&&eval(window.customScript),window.hasCandyRackUpsell&&registerFunction(handleCandyRackUpsell),registerFunction(handleAddToCartSubmit),registerFunction(renameAllOptions),registerFunction((()=>{new MutationObserver((e=>{renameAllOptions()})).observe(document.body,{childList:!0,subtree:!0})})),handleRebuyWidgets(),registerFunction(handleQuickAddDrawer),window.upcartModifyListOfUpsells=handleUpcartUpsell,window.upcartModifyCart=handleUpcartModifyCart}function registerFunction(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e,!1):(console.log("DOMContentLoaded has already fired. Executing directly."),e())}function registerFunctionOnWindowLoad(e){"complete"===document.readyState?(console.log("Window load already fired. Executing directly."),e()):window.addEventListener("load",e,!1)}function createNodeFilterByValue(e,t){for(var r,n=[],o=document.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return e.value&&(t.includes(e.value)||t.includes(e.textContent.trim()))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});r=o.nextNode();)r&&n.push(r);return n}function createNodeFilterByTextContent(e,t){for(var r,n=[],o=document.createNodeIterator(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){let r=!1;return window.isPureVariantName?r=t.includes(e.textContent.trim())||t.includes(e.textContent.trim().replace(",","")):t.forEach((t=>{e.textContent.trim().includes(t)&&(r=!0)})),r?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});r=o.nextNode();)r&&n.push(r);return n}function createNodeFilterByPrice(e,t){for(var r,n=[],o=document.createNodeIterator(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){let r=!1;return t.forEach((t=>{e.textContent.trim().includes(t)&&(r=!0)})),r?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});r=o.nextNode();)r&&n.push(r);return n}console.log("running ABConvert price test script 3 - with country code version - detect collection refresh version + search params");try{if((0,_helper_is_bot_js__WEBPACK_IMPORTED_MODULE_1__.Q)())return;recordSearchParams(),abconvertOperation()}catch(e){console.log("[ABConvert] Error: ",e.message)}})()})()})();
</script>
{% endcomment %}