<cart-drawer
  id="cart-drawer"
  class="cart-drawer drawer {% if cart.empty? %}drawer--center-body{% endif %}"
  initial-focus="false"
  handle-editor-events
  style="--cart-gifts-bg:{{ settings.cart_gifts_bg }};"
>
  <!-- Cart Header with Divider -->
  <p class="h4 cart-drawer-header" slot="header">{{ section.settings.cart_title }}
    <span class="text-md" style="
    font-weight: 500;
    font-size: 12px;
    text-transform: lowercase;
     margin-left:10px;                                                          
">({{ cart.item_count }} {% if cart.item_count == 1 %} item{% else %} items{% endif %})</span></p>
  
  {% render 'free-shipping-bar' %}
  
  {%- if cart.empty? -%}
  
  <div class="cart--empty-state">
    <!-- Empty cart state - show continue shopping button or loader -->
    <p class="h5 text-center">{{ 'cart.general.empty' | t }}</p>
    
    
    
    <!-- Continue Shopping Button -->
    {% if settings.empty_cart_btn_text != blank %}
      <a id="continue-shopping-btn" class="button btn--empty-cart" href="{{ settings.collection_link }}">{{ settings.empty_cart_btn_text }}</a>
    {% endif %}
    </div>
  {%- else -%}
    <!-- Cart has items - show main content -->
    <div id="cart-main-content">
      <span class="checkingOut h5 visitors_value"><span id="counter">140</span>+ People Are Checking Out Now</span>
      {% render 'free-gift' %}
      <div class="cart-drawer_products-container">
        <div class="cart-drawer_products-line-container relative">
          <div class="cart-drawer_bucket-container">
            <div class="cart-drawer__items">
              {%- for line_item in cart.items -%}
                {%- render 'line-item', line_item: line_item, show_quantity_selector: true -%}
              {%- endfor -%}
              {% render 'cart-drawer-free-gifts' %}
            </div>
          </div>
       
          <div class="cart-drawer_upsells-container" >
           <!-- Picked for You Section -->
              {% render 'upsell-cart-list' %}
          </div>
        </div>
      </div>
    </div>
     
    <!-- Fixed Total and Checkout Section at Bottom -->
    <div class="cart-drawer__footer gap-1 cart-drawer-footer" slot="footer">
     
      <!-- Subtotal and Savings Section -->
     <div class="cart-summary">
  
        {% assign luggagecover_product = all_products[settings.gift_one] %}
        {% assign giftcard_product = all_products[settings.gift_two] %}
        {% assign lifetime_warranty_product = all_products[settings.gift_three] %}
        {% assign dust_cover_product = all_products[settings.gift_four] %}
        {% assign duffel_dust_cover_product = all_products[settings.gift_five] %}
  
        {% comment %} Gift IDs for identification {% endcomment %}
        {% assign luggage_cover_id = luggagecover_product.variants.first.id %}
        {% assign gift_card_id = giftcard_product.variants.first.id %}
        {% assign gift_wrapping_id = lifetime_warranty_product.variants.first.id %}
        {% assign dust_cover_id = dust_cover_product.variants.first.id %}
        {% assign duffel_dust_cover_id = duffel_dust_cover_product.variants.first.id %}
  
        {%- assign total_savings = 0 -%}
        {%- for item in cart.items -%}
          {%- assign original_price = item.variant.compare_at_price | times: item.quantity -%}
          {%- assign current_price = item.final_line_price -%}
          
          {% comment %} Skip calculation for gift products {% endcomment %}
          {% unless item.variant_id == luggage_cover_id or item.variant_id == gift_card_id or item.variant_id == gift_wrapping_id or item.variant_id == dust_cover_id or item.variant_id == duffel_dust_cover_id  %}
            {%- if original_price > current_price -%}
              {%- assign savings = original_price | minus: current_price -%}
              {%- assign total_savings = total_savings | plus: savings -%}
            {%- endif -%}
          {% endunless %}
        {%- endfor -%}
        
        {% assign total_savings_money = total_savings | money %}
        {% if settings.show_cents %}
          {%- assign total_savings_cart = total_savings_money -%}
        {% else %}
          {%- assign total_savings_cart = total_savings_money | replace: '.00' -%}
        {% endif %}
  
        {% assign total_cart_money = cart.total_price | money %}
        {% if settings.show_cents %}
          {%- assign total_cart = total_cart_money -%}
        {% else %}
          {%- assign total_cart = total_cart_money | replace: '.00' -%}
        {% endif %}

        <!-- Savings display -->
          <div class="h-stack justify-between">
            {%- if total_savings > 0 -%}
              <span class="savings-label text-md" style="font-size:16px;">{{ section.settings.cart_discount }}</span>
              <span class="savings-value text-md" style="color:#317671;font-size:16px;">-{{ total_savings_cart }}</span>
            {%- endif -%}
          </div>
        <div class="h-stack justify-between">
          <span class="subtotal-label text-md" style="font-size:16px;">{{ section.settings.cart_incl_tax }}</span>
          <span class="subtotal-value text-md cart-total-price" style="font-size:16px;">{{ total_cart }}</span>
        </div>
      </div>

      {% case localization.market.handle  %}
      {% comment %}For US Market Only - Static Shop Pay Banner{% endcomment %} 
      {% when '0a5ca24a-afcd-465e-b822-58498e2bbb6a' %} 
        {%- if cart.total_price > 0 -%}
          {% render 'cart-payment-terms', cart: cart %}
        {%- endif -%}
    {% endcase %}
    <!-- ALSO ADD THIS CSS to completely hide any existing payment terms content -->
<style>
  /* Hide any existing payment terms that might cause flickering */
  .cart-drawer__payment-terms.payment-terms-stable,
  #extracted-payment-terms,
  #payment-content-display {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
  }

  /* Hide any payment-terms elements not in our wrapper */
  payment-terms:not(.cart-payment-terms-wrapper payment-terms) {
    display: none !important;
    visibility: hidden !important;
  }

  /* Ensure our static banner shows properly */
  .cart-payment-terms-wrapper {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  .shop-pay-banner-static {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
</style>

      <!-- Checkout Button Section -->
      <div class="button-group">
        {%- if section.settings.show_checkout_button -%}
          <form action="/checkout" method="post">
            <button
              type="submit"
              class="button w-full"
              aria-label="Proceed to checkout"
            >
              {{ section.settings.cart_checkout_button_text }}
            </button>
          </form>
        {%- endif -%}
      </div>

      <!-- Payment Methods Section -->
      {%- if shop.enabled_payment_types.size > 0 -%}
          <div class="payment-methods justify-center drawer_payments" style="gap: 0.1rem;">
          {% assign enabled_payment_types = 'american_express,apple_pay,discover,visa,master' | remove: ' ' | split: ',' %}
            {%- for type in enabled_payment_types -%}
              {{- type | payment_type_svg_tag -}}
            {%- endfor -%}
          </div>
        {%- endif -%}
    </div>
  {%- endif -%}
</cart-drawer>


{% schema %}
{
  "name": "t:sections.cart_drawer.name",
  "class": "shopify-section--cart-drawer",
  "tag": "section",
  "settings": [
    {
     "type": "checkbox",
      "id":"enable_custom_payment_terms",
      "label":"Enable custom payment terms",
      "default":false
    },
    {
      "type": "paragraph",
      "content": "t:sections.cart_drawer.page_info"
    },
    {
      "type": "text",
      "id": "cart_title",
      "label": "Cart Title",
      "default": "My Cart"
    },
    {
      "type": "text",
      "id": "freeshipping_title",
      "label": "Cart Free Shipping Title",
      "default": "Congratulations! You get free shipping."
    },
    {
      "type": "text",
      "id": "freeshipping_title_warning",
      "label": "Cart Freeshipping Title Warning",
      "default": "more to qualify for free shipping!"
    },
    {
      "type": "text",
      "id": "free_gift_tag_text",
      "label": "Free Gift Tag",
      "default": "Free Gift"
    },
    {
      "type": "text",
      "id": "cart-drawer-adc-button",
      "label": "Add to Cart Button",
      "default": "Add to Cart"
    },
    {
      "type": "text",
      "id": "cart_discount",
      "label": "Cart Discount Text",
      "default": "Discount"
    },
     {
      "type": "text",
      "id": "cart_incl_tax",
      "label": "Cart Include Tax Text",
      "default": "Total Including Tax"
    },
    {
      "type": "paragraph",
      "content": "t:sections.cart_drawer.free_shipping_bar_info"
    },
    {
      "type": "checkbox",
      "id": "show_cart_note",
      "label": "t:sections.cart_drawer.show_cart_note",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_shipping_text",
      "label": "t:sections.cart_drawer.show_shipping_text",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_view_cart_button",
      "label": "t:sections.cart_drawer.show_view_cart_button",
      "default": false
    },
    {
      "type": "text",
      "id": "cart_checkout_button_text",
      "label": "Cart Checkout Button Text",
      "default": "CheckOut"
    },
     {
      "type": "text",
      "id": "recommendations_title",
      "label": "Heading",
      "default": "Complete Your Travel Set"
    },
    {
      "type": "product_list",
      "id": "products",
      "label": "Recommendations",
      "info": "Suggest additional products to your customers.",
      "limit": 10
    },
    {
        "type": "image_picker",
        "id": "custom_icon",
        "label": "t:global.icons.custom_icon",
        "info": "t:global.icons.custom_icon_info"
    },
    {
      "type": "inline_richtext",
          "id": "title",
          "label": "t:global.text.heading",
          "default": "30-Day Satisfaction Guarantee"
    },
    {
      "type": "checkbox",
      "id": "show_checkout_button",
      "label": "t:sections.cart_drawer.show_checkout_button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_price_in_checkout_button",
      "label": "t:sections.cart_drawer.show_price_in_checkout_button",
      "default": true
    },
    {
      "type": "header",
      "content": "Featured Icon with text"
    },
    {
        "type": "image_picker",
        "id": "icon1",
        "label": "Icon 1",
        "info": "t:global.icons.custom_icon_info"
    },
    {
      "type": "inline_richtext",
          "id": "title1",
          "label": "Title 1",
          "default": "Dummy"
    },
    {
        "type": "image_picker",
        "id": "icon2",
        "label": "Icon 2",
        "info": "t:global.icons.custom_icon_info"
    },
    {
      "type": "inline_richtext",
          "id": "title2",
          "label": "Title 2",
          "default": "Dummy"
    },
    {
        "type": "image_picker",
        "id": "icon3",
        "label": "Icon 3",
        "info": "t:global.icons.custom_icon_info"
    },
    {
      "type": "inline_richtext",
          "id": "title3",
          "label": "Title 3",
          "default": "Dummy"
    }
  ]
}
{% endschema %}